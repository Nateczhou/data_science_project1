eb2a <- eb2 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Initial Approvals in Each State"))
eb1a <- eb1 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Initial Approvals in Each State"))
grid.arrange(eb2, eb2a, ncol= 1, nrow = 2, width = c(1.5, 1))
#elbow_rooml
elbow_roomll <- us_base + geom_polygon(data = state_approval, aes(fill = percentiniapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb2 <- elbow_rooml + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_approval$totalinitialapp),1000, 6000, median(state_approval$totalinitialapp), 100000, max(state_approval$totalinitialapp)), trans = "log10", name = "Numbers of Initial Approval") + labs(title = "Map of Numbers of Initial Approvals in Each State")
eb1 <- elbow_roomll + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of Initial Approvals", breaks = c(96, 92, 88, 84, min(state_approval$percentiniapp))) + ggtitle("Map of Percentage of Initial Approvals in Each State")
eb2a <- eb2 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Initial Approvals in Each State"))
eb1a <- eb1 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Initial Approvals in Each State"))
grid.arrange(eb2, eb2a, ncol= 1, width = c(1.5, 1))
#elbow_rooml
elbow_roomll <- us_base + geom_polygon(data = state_approval, aes(fill = percentiniapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb2 <- elbow_rooml + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_approval$totalinitialapp),1000, 6000, median(state_approval$totalinitialapp), 100000, max(state_approval$totalinitialapp)), trans = "log10", name = "Numbers of Initial Approval") + labs(title = "Map of Numbers of Initial Approvals in Each State")
eb1 <- elbow_roomll + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of Initial Approvals", breaks = c(96, 92, 88, 84, min(state_approval$percentiniapp))) + ggtitle("Map of Percentage of Initial Approvals in Each State")
eb2a <- eb2 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Initial Approvals in Each State"))
eb1a <- eb1 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Initial Approvals in Each State"))
grid.arrange(eb2, eb2a, ncol= 1, width = c(2, 2))
#elbow_rooml
elbow_roomll <- us_base + geom_polygon(data = state_approval, aes(fill = percentiniapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb2 <- elbow_rooml + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_approval$totalinitialapp),1000, 6000, median(state_approval$totalinitialapp), 100000, max(state_approval$totalinitialapp)), trans = "log10", name = "Numbers of Initial Approval") + labs(title = "Map of Numbers of Initial Approvals in Each State")
eb1 <- elbow_roomll + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of Initial Approvals", breaks = c(96, 92, 88, 84, min(state_approval$percentiniapp))) + ggtitle("Map of Percentage of Initial Approvals in Each State")
eb2a <- eb2 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Initial Approvals in Each State"))
eb1a <- eb1 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Initial Approvals in Each State"))
grid.arrange(eb2, eb2a, ncol= 1)
eb2
eb2a
eb1
eb1a
#elbow_rooml
elbow_roomll <- us_base + geom_polygon(data = state_approval, aes(fill = percentiniapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb2 <- elbow_rooml + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_approval$totalinitialapp),1000, 6000, median(state_approval$totalinitialapp), 100000, max(state_approval$totalinitialapp)), trans = "log10", name = "Numbers of Initial Approval") + labs(title = "Map of Numbers of Initial Approvals in Each State")
eb1 <- elbow_roomll + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of Initial Approvals", breaks = c(96, 92, 88, 84, min(state_approval$percentiniapp))) + ggtitle("Map of Percentage of Initial Approvals in Each State")
eb2a <- eb2 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Initial Approvals in Each State"))
eb1a <- eb1 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Initial Approvals in Each State"))
grid.arrange(eb2, eb2a, ncol= 1)
grid.arrange(eb1, eb1a, ncol= 1)
#eb2
#eb2a
#eb1
#eb1a
#elbow_rooml
elbow_roomll <- us_base + geom_polygon(data = state_approval, aes(fill = percentiniapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb2 <- elbow_rooml + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_approval$totalinitialapp),1000, 6000, median(state_approval$totalinitialapp), 100000, max(state_approval$totalinitialapp)), trans = "log10", name = "Numbers of Initial Approval") + labs(title = "Map of Numbers of Initial Approvals in Each State")
eb1 <- elbow_roomll + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of Initial Approvals", breaks = c(96, 92, 88, 84, min(state_approval$percentiniapp))) + ggtitle("Map of Percentage of Initial Approvals in Each State")
eb2a <- eb2 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Initial Approvals in Each State"))
eb1a <- eb1 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Initial Approvals in Each State"))
z <- grid.arrange(eb2, eb2a, ncol= 1)
x <- grid.arrange(eb1, eb1a, ncol= 1)
grid.arrange(x, z, nrow = 1)
#eb2
#eb2a
#eb1
#eb1a
h1b <- read.csv('h1b_datahubexport_2009-2019.csv')
str(h1b)
#h1b$State
library(dplyr)
library(tidyr)
#nas <- na.omit(h1b$State)
#nas
new <- h1b %>% drop_na(State) %>% group_by(State) %>%
summarise(totalinitialapp = sum(Initial.Approvals, na.rm = T),
totalinitialden = sum(Initial.Denials, na.rm = T),
totalcontapp = sum(Continuing.Approvals, na.rm = T),
totalcontden = sum(Continuing.Denials, na.rm = T),
totalinitial = sum((totalinitialapp + totalinitialden), na.rm = T),
totalcontinue = sum((totalcontapp+totalcontden), na.rm = T),
percentiniapp = ((totalinitialapp/totalinitial) * 100),
percentiniden = (totalinitialden/totalinitial) * 100,
percentcontapp = (totalcontapp/totalcontinue) *100,
percentcontden = (totalcontden/totalcontinue) * 100
)
test <- h1b %>% drop_na(State) %>% group_by(State) %>%
summarise(totalinitialapp = sum(Initial.Approvals, na.rm = T))
head(new)
library(ggplot2)
library(maps)
library(usmap)
library(openintro)
library(tidyverse)
library(gridExtra)
usstate <- map_data("state")
copy <- map_data("state")
colnames(usstate)[colnames(usstate)=="region"] <- "State_name"
usstate <- usstate %>% mutate(State = state2abbr(State_name))
new$State <- as.character(new$State)
state_lo <- inner_join(usstate, new, by = "State")
state_lo <- state_lo[state_lo$State %in%state.abb,]
head(state_lo)
state_approval <- state_lo %>% select(long, lat, group, order, State, totalinitialapp, percentiniapp, State_name)
head(state_approval)
state_den <- state_lo %>% select(long, lat, group, order, State, totalinitialden, percentiniden, State_name)
state_contapp <- state_lo %>% select(long, lat, group, order, State, totalcontapp, percentcontapp, State_name)
state_contden <- state_lo %>% select(long, lat, group, order, State, totalcontden, percentcontden, State_name)
us_base <- ggplot(data = state_approval, mapping = aes(x = long, y = lat, group = group)) +
coord_fixed(1.3) +
geom_polygon(color = "black", fill = "gray")
#us_base + theme_nothing()
# base <- plot_usmap(regions = "states", data = state_approval, values = NULL, include = NULL, exclude = NULL) +
#   coord_fixed(1.3) +
#   geom_polygon(color = "black", fill = "gray")
ditch_the_axes <- theme(
axis.text = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank(),
axis.title = element_blank()
)
elbow_rooml <- us_base + geom_polygon(data = state_approval, aes(fill = totalinitialapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
m1 <- new %>% group_by(State) %>% arrange(desc(percentiniapp)) %>% select(State, percentiniapp, totalinitialapp) %>% head()
m2 <- new %>% group_by(State) %>% arrange(desc(totalinitialapp)) %>% select(State, totalinitialapp, percentiniapp) %>% head()
m2
m1
#elbow_rooml
elbow_roomll <- us_base + geom_polygon(data = state_approval, aes(fill = percentiniapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb2 <- elbow_rooml + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_approval$totalinitialapp),1000, 6000, median(state_approval$totalinitialapp), 100000, max(state_approval$totalinitialapp)), trans = "log10", name = "Numbers of Initial Approval") + labs(title = "Map of Numbers of Initial Approvals in Each State")
eb1 <- elbow_roomll + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of Initial Approvals", breaks = c(96, 92, 88, 84, min(state_approval$percentiniapp))) + ggtitle("Map of Percentage of Initial Approvals in Each State")
eb2a <- eb2 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Initial Approvals in Each State"))
eb1a <- eb1 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Initial Approvals in Each State"))
z <- grid.arrange(eb2, eb2a, ncol= 1)
x <- grid.arrange(eb1, eb1a, ncol= 1)
#eb2
#eb2a
#eb1
#eb1a
elbow_room2 <- us_base + geom_polygon(data = state_den, aes(fill = totalinitialden), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb3 <- elbow_room2 + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_den$totalinitialden),1000, 6000, median(state_den$totalinitialden), 100000, max(state_den$totalinitialden)), trans = "log10", name = "Number of Initial Denial") + labs(title = "Map of Numbers of Initial Denials in Each State")
eb3
elbow_room2l <- us_base + geom_polygon(data = state_den, aes(fill = percentiniden), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
a <- c(4, 8, 12, 16, 19)
eb3l <- elbow_room2l + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = a, name = "Percentage of Initial Denial") + labs(title = "Map of Percentage of Initial Denials in Each State")
eb3l
eb3a <- eb3 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Initial Denials in Each State"))
eb3la <- eb3l + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Initial Denials in Each State"))
grid.arrange(eb3, eb3a, ncol = 1)
grid.arrange(eb3l, eb3la, ncol = 1)
m3 <- new %>% group_by(State) %>% arrange(desc(totalcontapp)) %>% head(n = 5) %>% select(State, totalcontapp, percentcontapp)
m3
m4 <- new %>% group_by(State) %>% arrange(desc(percentcontapp)) %>% head(n =9) %>% select(State, percentcontapp, totalcontapp)
m5 <- new %>% group_by(State) %>% arrange(desc(percentcontapp)) %>% select(State, percentcontapp, totalcontapp) %>% filter(totalcontapp > 65000, percentcontapp > 95.00)
#m5
m4
elbow_room3 <- us_base + geom_polygon(data = state_contapp, aes(fill = totalcontapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb4 <- elbow_room3 + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_contapp$totalcontapp),1000, 6000, median(state_contapp$totalcontapp), 100000, max(state_contapp$totalcontapp)), trans = "log10", name = "Numbers of Continue Approval") +
labs(title = "Map of Numbers of Continue Approvals in Each State")
eb4
elbow_room3l <- us_base + geom_polygon(data = state_contapp, aes(fill = percentcontapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb4l <- elbow_room3l + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of Continue Approval") +
labs(title = "Map of Percentage of Continue Approvals in Each State")
eb4l
eb4a <- eb4 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Continue Approvals in Each State"))
eb4la <- eb4l + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Continue Approvals in Each State"))
grid.arrange(eb4, eb4a, ncol = 1)
grid.arrange(eb4l, eb4la, ncol= 1)
elbow_room4 <- us_base + geom_polygon(data = state_contden, aes(fill = totalcontden), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb5 <- elbow_room4 + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_contden$totalcontden),1000, 6000, median(state_contden$totalcontden), 100000, max(state_contden$totalcontden)), trans = "log10", name = "Numbers of continue denial") + labs(title = "Map of Numbers of Continue Denials in Each State")
eb5
elbow_room4l <- us_base + geom_polygon(data = state_contden, aes(fill = percentcontden), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb5l <- elbow_room4l + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of continue denial", breaks = c(2, 3, 4, 5, 6, 7, 7.78)) + labs(title = "Map of Percentage of Continue Denials in Each State")
eb5l
eb5a <- eb5 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Continue Denials in Each State"))
eb5la <- eb5l + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Continue Denials in Each State"))
grid.arrange(eb5, eb5a, ncol = 1)
grid.arrange(eb5l, eb5la, ncol = 1)
m6 <- new %>% group_by(State) %>% arrange(desc(percentcontden)) %>% select(State, percentcontden, totalcontden) %>% filter(totalcontden > 6000, percentcontden > 5.00)
m6
#elbow_rooml
elbow_roomll <- us_base + geom_polygon(data = state_approval, aes(fill = percentiniapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb2 <- elbow_rooml + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_approval$totalinitialapp),1000, 6000, median(state_approval$totalinitialapp), 100000, max(state_approval$totalinitialapp)), trans = "log10", name = "Numbers of Initial Approval") + labs(title = "Map of Numbers of Initial Approvals in Each State")
eb1 <- elbow_roomll + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of Initial Approvals", breaks = c(96, 92, 88, 84, min(state_approval$percentiniapp))) + ggtitle("Map of Percentage of Initial Approvals in Each State")
eb2a <- eb2 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Initial Approvals in Each State"))
eb1a <- eb1 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Initial Approvals in Each State"))
z <- grid.arrange(eb2, eb2a, ncol= 1)
x <- grid.arrange(eb1, eb1a, ncol= 1)
#eb2
#eb2a
#eb1
#eb1a
m3 <- new %>% group_by(State) %>% arrange(desc(totalcontapp)) %>% head(n = 5) %>% select(State, totalcontapp, percentcontapp)
m3
m4 <- new %>% group_by(State) %>% arrange(desc(percentcontapp)) %>% head(n =9) %>% select(State, percentcontapp, totalcontapp)
m5 <- new %>% group_by(State) %>% arrange(desc(percentcontapp)) %>% select(State, percentcontapp, totalcontapp) %>% filter(totalcontapp > 65000, percentcontapp > 95.00)
m5
h1b <- read.csv('h1b_datahubexport_2009-2019.csv')
str(h1b)
#h1b$State
h1b <- read.csv('h1b_datahubexport_2009-2019.csv')
str(h1b)
#h1b$State
library(dplyr)
library(tidyr)
#nas <- na.omit(h1b$State)
#nas
new <- h1b %>% drop_na(State) %>% group_by(State) %>%
summarise(totalinitialapp = sum(Initial.Approvals, na.rm = T),
totalinitialden = sum(Initial.Denials, na.rm = T),
totalcontapp = sum(Continuing.Approvals, na.rm = T),
totalcontden = sum(Continuing.Denials, na.rm = T),
totalinitial = sum((totalinitialapp + totalinitialden), na.rm = T),
totalcontinue = sum((totalcontapp+totalcontden), na.rm = T),
percentiniapp = ((totalinitialapp/totalinitial) * 100),
percentiniden = (totalinitialden/totalinitial) * 100,
percentcontapp = (totalcontapp/totalcontinue) *100,
percentcontden = (totalcontden/totalcontinue) * 100
)
test <- h1b %>% drop_na(State) %>% group_by(State) %>%
summarise(totalinitialapp = sum(Initial.Approvals, na.rm = T))
head(new)
library(ggplot2)
library(maps)
library(usmap)
library(openintro)
library(tidyverse)
library(gridExtra)
usstate <- map_data("state")
copy <- map_data("state")
colnames(usstate)[colnames(usstate)=="region"] <- "State_name"
usstate <- usstate %>% mutate(State = state2abbr(State_name))
new$State <- as.character(new$State)
state_lo <- inner_join(usstate, new, by = "State")
state_lo <- state_lo[state_lo$State %in%state.abb,]
head(state_lo)
state_approval <- state_lo %>% select(long, lat, group, order, State, totalinitialapp, percentiniapp, State_name)
head(state_approval)
state_den <- state_lo %>% select(long, lat, group, order, State, totalinitialden, percentiniden, State_name)
state_contapp <- state_lo %>% select(long, lat, group, order, State, totalcontapp, percentcontapp, State_name)
state_contden <- state_lo %>% select(long, lat, group, order, State, totalcontden, percentcontden, State_name)
us_base <- ggplot(data = state_approval, mapping = aes(x = long, y = lat, group = group)) +
coord_fixed(1.3) +
geom_polygon(color = "black", fill = "gray")
#us_base + theme_nothing()
# base <- plot_usmap(regions = "states", data = state_approval, values = NULL, include = NULL, exclude = NULL) +
#   coord_fixed(1.3) +
#   geom_polygon(color = "black", fill = "gray")
ditch_the_axes <- theme(
axis.text = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank(),
axis.title = element_blank()
)
elbow_rooml <- us_base + geom_polygon(data = state_approval, aes(fill = totalinitialapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
m1 <- new %>% group_by(State) %>% arrange(desc(percentiniapp)) %>% select(State, percentiniapp, totalinitialapp) %>% head()
m2 <- new %>% group_by(State) %>% arrange(desc(totalinitialapp)) %>% select(State, totalinitialapp, percentiniapp) %>% head()
m2
m1
#elbow_rooml
elbow_roomll <- us_base + geom_polygon(data = state_approval, aes(fill = percentiniapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb2 <- elbow_rooml + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_approval$totalinitialapp),1000, 6000, median(state_approval$totalinitialapp), 100000, max(state_approval$totalinitialapp)), trans = "log10", name = "Numbers of Initial Approval") + labs(title = "Map of Numbers of Initial Approvals in Each State")
eb1 <- elbow_roomll + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of Initial Approvals", breaks = c(96, 92, 88, 84, min(state_approval$percentiniapp))) + ggtitle("Map of Percentage of Initial Approvals in Each State")
eb2a <- eb2 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Initial Approvals in Each State"))
eb1a <- eb1 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Initial Approvals in Each State"))
z <- grid.arrange(eb2, eb2a, ncol= 1)
x <- grid.arrange(eb1, eb1a, ncol= 1)
#eb2
#eb2a
#eb1
#eb1a
elbow_room2 <- us_base + geom_polygon(data = state_den, aes(fill = totalinitialden), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb3 <- elbow_room2 + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_den$totalinitialden),1000, 6000, median(state_den$totalinitialden), 100000, max(state_den$totalinitialden)), trans = "log10", name = "Number of Initial Denial") + labs(title = "Map of Numbers of Initial Denials in Each State")
#eb3
elbow_room2l <- us_base + geom_polygon(data = state_den, aes(fill = percentiniden), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
a <- c(4, 8, 12, 16, 19)
eb3l <- elbow_room2l + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = a, name = "Percentage of Initial Denial") + labs(title = "Map of Percentage of Initial Denials in Each State")
#eb3l
eb3a <- eb3 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Initial Denials in Each State"))
eb3la <- eb3l + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Initial Denials in Each State"))
grid.arrange(eb3, eb3a, ncol = 1)
grid.arrange(eb3l, eb3la, ncol = 1)
m3 <- new %>% group_by(State) %>% arrange(desc(totalcontapp)) %>% head(n = 5) %>% select(State, totalcontapp, percentcontapp)
m3
m4 <- new %>% group_by(State) %>% arrange(desc(percentcontapp)) %>% head(n =9) %>% select(State, percentcontapp, totalcontapp)
m5 <- new %>% group_by(State) %>% arrange(desc(percentcontapp)) %>% select(State, percentcontapp, totalcontapp) %>% filter(totalcontapp > 65000, percentcontapp > 95.00)
#m5
m4
elbow_room3 <- us_base + geom_polygon(data = state_contapp, aes(fill = totalcontapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb4 <- elbow_room3 + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_contapp$totalcontapp),1000, 6000, median(state_contapp$totalcontapp), 100000, max(state_contapp$totalcontapp)), trans = "log10", name = "Numbers of Continue Approval") +
labs(title = "Map of Numbers of Continue Approvals in Each State")
#eb4
elbow_room3l <- us_base + geom_polygon(data = state_contapp, aes(fill = percentcontapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb4l <- elbow_room3l + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of Continue Approval") +
labs(title = "Map of Percentage of Continue Approvals in Each State")
#eb4l
eb4a <- eb4 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Continue Approvals in Each State"))
eb4la <- eb4l + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Continue Approvals in Each State"))
grid.arrange(eb4, eb4a, ncol = 1)
grid.arrange(eb4l, eb4la, ncol= 1)
elbow_room4 <- us_base + geom_polygon(data = state_contden, aes(fill = totalcontden), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb5 <- elbow_room4 + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_contden$totalcontden),1000, 6000, median(state_contden$totalcontden), 100000, max(state_contden$totalcontden)), trans = "log10", name = "Numbers of continue denial") + labs(title = "Map of Numbers of Continue Denials in Each State")
#eb5
elbow_room4l <- us_base + geom_polygon(data = state_contden, aes(fill = percentcontden), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb5l <- elbow_room4l + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of continue denial", breaks = c(2, 3, 4, 5, 6, 7, 7.78)) + labs(title = "Map of Percentage of Continue Denials in Each State")
#eb5l
eb5a <- eb5 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Continue Denials in Each State"))
eb5la <- eb5l + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Continue Denials in Each State"))
grid.arrange(eb5, eb5a, ncol = 1)
grid.arrange(eb5l, eb5la, ncol = 1)
m6 <- new %>% group_by(State) %>% arrange(desc(percentcontden)) %>% select(State, percentcontden, totalcontden) %>% filter(totalcontden > 6000, percentcontden > 5.00)
m6
h1b <- read.csv('h1b_datahubexport_2009-2019.csv')
str(h1b)
#h1b$State
library(dplyr)
library(tidyr)
#nas <- na.omit(h1b$State)
#nas
new <- h1b %>% drop_na(State) %>% group_by(State) %>%
summarise(totalinitialapp = sum(Initial.Approvals, na.rm = T),
totalinitialden = sum(Initial.Denials, na.rm = T),
totalcontapp = sum(Continuing.Approvals, na.rm = T),
totalcontden = sum(Continuing.Denials, na.rm = T),
totalinitial = sum((totalinitialapp + totalinitialden), na.rm = T),
totalcontinue = sum((totalcontapp+totalcontden), na.rm = T),
percentiniapp = ((totalinitialapp/totalinitial) * 100),
percentiniden = (totalinitialden/totalinitial) * 100,
percentcontapp = (totalcontapp/totalcontinue) *100,
percentcontden = (totalcontden/totalcontinue) * 100
)
test <- h1b %>% drop_na(State) %>% group_by(State) %>%
summarise(totalinitialapp = sum(Initial.Approvals, na.rm = T))
head(new)
library(ggplot2)
library(maps)
library(usmap)
library(openintro)
library(tidyverse)
library(gridExtra)
usstate <- map_data("state")
copy <- map_data("state")
colnames(usstate)[colnames(usstate)=="region"] <- "State_name"
usstate <- usstate %>% mutate(State = state2abbr(State_name))
new$State <- as.character(new$State)
state_lo <- inner_join(usstate, new, by = "State")
state_lo <- state_lo[state_lo$State %in%state.abb,]
head(state_lo)
state_approval <- state_lo %>% select(long, lat, group, order, State, totalinitialapp, percentiniapp, State_name)
head(state_approval)
state_den <- state_lo %>% select(long, lat, group, order, State, totalinitialden, percentiniden, State_name)
state_contapp <- state_lo %>% select(long, lat, group, order, State, totalcontapp, percentcontapp, State_name)
state_contden <- state_lo %>% select(long, lat, group, order, State, totalcontden, percentcontden, State_name)
us_base <- ggplot(data = state_approval, mapping = aes(x = long, y = lat, group = group)) +
coord_fixed(1.3) +
geom_polygon(color = "black", fill = "gray")
#us_base + theme_nothing()
# base <- plot_usmap(regions = "states", data = state_approval, values = NULL, include = NULL, exclude = NULL) +
#   coord_fixed(1.3) +
#   geom_polygon(color = "black", fill = "gray")
ditch_the_axes <- theme(
axis.text = element_blank(),
axis.line = element_blank(),
axis.ticks = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank(),
axis.title = element_blank()
)
elbow_rooml <- us_base + geom_polygon(data = state_approval, aes(fill = totalinitialapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
m1 <- new %>% group_by(State) %>% arrange(desc(percentiniapp)) %>% select(State, percentiniapp, totalinitialapp) %>% head()
m2 <- new %>% group_by(State) %>% arrange(desc(totalinitialapp)) %>% select(State, totalinitialapp, percentiniapp) %>% head()
m2
m1
#elbow_rooml
elbow_roomll <- us_base + geom_polygon(data = state_approval, aes(fill = percentiniapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb2 <- elbow_rooml + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_approval$totalinitialapp),1000, 6000, median(state_approval$totalinitialapp), 100000, max(state_approval$totalinitialapp)), trans = "log10", name = "Numbers of Initial Approval") + labs(title = "Map of Numbers of Initial Approvals in Each State")
eb1 <- elbow_roomll + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of Initial Approvals", breaks = c(96, 92, 88, 84, min(state_approval$percentiniapp))) + ggtitle("Map of Percentage of Initial Approvals in Each State")
eb2a <- eb2 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Initial Approvals in Each State"))
eb1a <- eb1 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Initial Approvals in Each State"))
z <- grid.arrange(eb2, eb2a, ncol= 1)
x <- grid.arrange(eb1, eb1a, ncol= 1)
#eb2
#eb2a
#eb1
#eb1a
elbow_room2 <- us_base + geom_polygon(data = state_den, aes(fill = totalinitialden), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb3 <- elbow_room2 + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_den$totalinitialden),1000, 6000, median(state_den$totalinitialden), 100000, max(state_den$totalinitialden)), trans = "log10", name = "Number of Initial Denial") + labs(title = "Map of Numbers of Initial Denials in Each State")
#eb3
elbow_room2l <- us_base + geom_polygon(data = state_den, aes(fill = percentiniden), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
a <- c(4, 8, 12, 16, 19)
eb3l <- elbow_room2l + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = a, name = "Percentage of Initial Denial") + labs(title = "Map of Percentage of Initial Denials in Each State")
#eb3l
eb3a <- eb3 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Initial Denials in Each State"))
eb3la <- eb3l + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Initial Denials in Each State"))
grid.arrange(eb3, eb3a, ncol = 1)
grid.arrange(eb3l, eb3la, ncol = 1)
m3 <- new %>% group_by(State) %>% arrange(desc(totalcontapp)) %>% head(n = 5) %>% select(State, totalcontapp, percentcontapp)
m3
m4 <- new %>% group_by(State) %>% arrange(desc(percentcontapp)) %>% head(n =9) %>% select(State, percentcontapp, totalcontapp)
m5 <- new %>% group_by(State) %>% arrange(desc(percentcontapp)) %>% select(State, percentcontapp, totalcontapp) %>% filter(totalcontapp > 65000, percentcontapp > 95.00)
#m5
m4
elbow_room3 <- us_base + geom_polygon(data = state_contapp, aes(fill = totalcontapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb4 <- elbow_room3 + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_contapp$totalcontapp),1000, 6000, median(state_contapp$totalcontapp), 100000, max(state_contapp$totalcontapp)), trans = "log10", name = "Numbers of Continue Approval") +
labs(title = "Map of Numbers of Continue Approvals in Each State")
#eb4
elbow_room3l <- us_base + geom_polygon(data = state_contapp, aes(fill = percentcontapp), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb4l <- elbow_room3l + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of Continue Approval") +
labs(title = "Map of Percentage of Continue Approvals in Each State")
#eb4l
eb4a <- eb4 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Continue Approvals in Each State"))
eb4la <- eb4l + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Continue Approvals in Each State"))
grid.arrange(eb4, eb4a, ncol = 1)
grid.arrange(eb4l, eb4la, ncol= 1)
elbow_room4 <- us_base + geom_polygon(data = state_contden, aes(fill = totalcontden), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb5 <- elbow_room4 + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_contden$totalcontden),1000, 6000, median(state_contden$totalcontden), 100000, max(state_contden$totalcontden)), trans = "log10", name = "Numbers of continue denial") + labs(title = "Map of Numbers of Continue Denials in Each State")
#eb5
elbow_room4l <- us_base + geom_polygon(data = state_contden, aes(fill = percentcontden), color = "white") +
geom_polygon(color = "black", fill = NA) +
theme_bw() +
ditch_the_axes
eb5l <- elbow_room4l + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), name = "Percentage of continue denial", breaks = c(2, 3, 4, 5, 6, 7, 7.78)) + labs(title = "Map of Percentage of Continue Denials in Each State")
#eb5l
eb5a <- eb5 + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Numbers of Continue Denials in Each State"))
eb5la <- eb5l + coord_cartesian(xlim = c(-65, -85), ylim = c(35, 45)) + ggtitle(("East Side Zoomed In Version of Percentage of Continue Denials in Each State"))
grid.arrange(eb5, eb5a, ncol = 1)
grid.arrange(eb5l, eb5la, ncol = 1)
m6 <- new %>% group_by(State) %>% arrange(desc(percentcontden)) %>% select(State, percentcontden, totalcontden) %>% filter(totalcontden > 6000, percentcontden > 5.00)
m6
knitr::opts_chunk$set(echo = FALSE)
titanic_orig <- read.csv("Titanic.csv")
str(titanic_orig)
titanic_orig <- read.csv("Titanic.csv")
str(titanic_orig)
view(titanic_orig)
library(dplyr)
