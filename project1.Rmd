---
title: "H-1B Visa"
author: "Spencer Stucky, Cheng Zeng, Wenyu Zeng, Chao Zhou"
date: "10/14/2019"
output:
  html_document:
    toc: yes
    toc_depth: 4
    fig.align: "center"
    toc_float: yes
    theme: readable
  pdf_document:
    toc: yes
    toc_depth: '4'
---

```{r, include = F}
library(dplyr)
library(maps)
h1b <- read.csv('h1b_datahubexport_2009-2019.csv')
#h1b <- h1b[h1b$State %in%state.abb,]
```
How have U.S. H1b visa acceptances and denials changed over the course of 2015-2019?1a) How does industry effect H1b visas from the time spanning 2015-2019?

# Chapter 1: Introduction

H-1B visa is a type of non-immigrate visa of United States that under the Immigration and Nationality Act since 1952. This visa allows foreign workers (individual) to enter United Stated to temporarily be employed by U.S. employers in specialty occupations. (Path2usa) With the development of the world, more and more people are looking for opportunities in U.S. Therefore, the number of applications for H-1B are rising every year. Each year, the total number of H-1B petitions that U.S. congress allowed to approve for a fiscal year is 65,000 for regular cap and 20,000 master’s exemption. (USCIS) According to the summary of USCIS H-1B 2019, there are more than 190,000 applications were submitted and 94,213 for regular quota and 95,885 for master quota. (USCIS) However, after Donald Trump become president, he signed the "Buy American, Hire American" executive order in April 2017. (USCIS) Though, this order helps U.S. employers hire most-skills foreign employees, the approval of this visa became harder and harder.

Nonetheless, politics is not the only factor that affects H-1B’s approval rate, but industries and location are also impact it. In this report, we will focus on the relationship in _______fill in the blank_______________________________________.

# Chapter 2: Description of Data

The source data 
```{r, echo=FALSE}
str(h1b)
```
xxxxxxx

# Chapter 3: Location Factor

## 3.1: Industries vs NAICS 



### 3.1.1: S.M.A.R.T Question


Meow Meow Meow 








# Chapter 4: Industries Factor


In this Chapter, we are using data to search for the relationship between H-1B approval and denial rate with industry. Also, we compare the rate with industry by year because we attempt to understand whether the year associates with the rate and industry.  


## 4.1: Industries vs NAICS 

### 4.1.1: S.M.A.R.T Question

**Does industry relates to H-1B initial or continuing approval and denial rate between 2009-2019?**

### 4.1.2: Initial Application


To analyze the NAICS and denial rate, we used group by to combine the same industry. Ideally, we want to use the total denial amount to compare the difference in industries. Since the applicant amount of NAICS 54 (Professional, Scientific, and Technical Services) far exceed other industries, we decided to use percentage to present our data.


```{r initial, echo=FALSE} 
library(ggplot2)
h1b$naics = as.factor(h1b$NAICS)
# use group by to combine same industry together to calculate the total initial application amount.
initial <- h1b %>% group_by(naics) %>% summarize( totaliniaccpt = sum(Initial.Approvals, na.rm = T), #shows total number of initail approvals
                                                  totaliniden = sum(Initial.Denials, na.rm = T), # shows total number of initial denials
                                                  totalinitial = sum(Initial.Approvals,na.rm = T)+sum(Initial.Denials,na.rm = T), # shows total number of initial application
                                                  iaccptperc = (totaliniaccpt/totalinitial)*100, # percentage of initial approval rate
                                                  idenperc = (totaliniden/totalinitial)*100) #percentage of initial denial rate
# 
# ggplot(initial, aes(x = naics, y = iaccptperc, color = naics, fill = naics)) + # percentage of initial approvals rate and color by industry code
#   geom_bar(stat ="identity") +
#   xlab("NAICS CODE") +
#   ylab("Total Initial Approvals Percentage")
# 
# ggsave("Total Initial Approvals Percentage.png", width=12, height=9)

ggplot(initial, aes(x = naics, y = idenperc, color = naics, , fill = naics)) + # percentage of initial denials rate and color by industry code
  geom_bar(stat ="identity") + 
  xlab("NAICS CODE") + 
  ylab("Total Initial Denials Percentage") 

#ggsave("Total Denial Approvals Percentage.png", width=12, height=9)


```


From the total initial denial’s percentage, we can see the lowest percentage is 21 – Mining industry, which is only 2.87%; in other word, mining industry has the overall highest initial approval rate. According to NAICS association website that mining includes Oil and Gas Extraction, Coal Mining, Metal Ore Mining and Nonmetallic Mineral Mining and Quarrying. Sue Kihn indicated in his article that mining companies are increasing their budgets on recruiting activities. She believes that seasoned miners are in limited supply after many quit from this industry in leaner times. (Kihn) Even though worldwide has good number of mining-related programs, the industry still requires well-train labor nowadays. Therefore, USCIS is willing to give the H-1B visa to foreign labor so they can help to develop U.S mining industry. (Brandon)

Nonetheless, 72, Accommodation and Food Services, has the highest initial denial percentage which is 28.19%. Based on NAICS association, hospitality, traveler accommodation, special food services and restaurants are all included. Since most of the companies depends on the season or holiday; thus, majority of these companies only need temporary workers. USCIS provide another type of visa, H-2B, for those temporary non-agricultural workers. In additional, there are many companies are small business, which cannot fulfill the requirement of H-1B, especially after the new policy came out, the application check is harsher. It causes the initial denial rate of Accommodation and Food Services really high. 


### 4.1.3: Continuing Application
```{r continuing, echo=FALSE}
# use group by to combine same industry together to calculate the total continuing application amount.
continuing <- h1b %>% group_by(naics) %>% summarize( totalconaccpt = sum(Continuing.Approvals, na.rm = T),
                                                  totalconden = sum(Continuing.Denials, na.rm = T),
                                                  totalcontinue = sum(Continuing.Approvals,na.rm = T)+sum(Continuing.Denials,na.rm = T),
                                                  caccptperc = (totalconaccpt/totalcontinue) * 100,
                                                  cdenperc = ( totalconden /totalcontinue) * 100 )
# ggplot(continuing, aes(x = naics, y = caccptperc, color = naics, fill = naics)) + geom_bar(stat ="identity") + xlab("NAICS CODE") + ylab("Total Continuing Approvals Percentage")
# ggsave("Total Continuing Approvals Percentage.png", width=12, height=9)

ggplot(continuing, aes(x = naics, y = cdenperc, color = naics, fill = naics)) + geom_bar(stat ="identity") + xlab("NAICS CODE") + ylab("Total Continuing Denials Percentage")

#ggsave("Total Continuing DenialsPercentage.png", width=12, height=9)
```
In the above graph, industry code 99 has the highest continual denials percentage. However, 99 is nonclassifiable establishments which means the industry is unknown. Since the purpose of this section for industry and H1B approval or denial rate, we will not analysis this industry code. 
Next, we can see the industry 55, Management of Companies and Enterprises, has the lowest continuing denials percentage which is 1.61%. This industry includes Banking, Security and financial companies. Eight major investment banks (such as Bank of American, JPMorgan Chase & Co. and Goldman Sachs Group Inc.) are using the similar way to hire the high-skill employee as tech companies; hence, they increased their H-1B applications for high-skilled workers by almost 60% over five years to more than 7,000 in fiscal year 2017, according to a Bloomberg analysis of visa filing data. (Yang)

## 4.2: Industries vs NAICS by Year


### 4.2.1: Initial Application

In this part we are trying to include yearly change for each industry.  

```{r fig.width=12, fig.height=9,initialwithyear, echo=F}
#install.packages("directlabels")
library(directlabels)

initialbyyear <- h1b %>% group_by(Fiscal.Year, naics) %>% summarize( totaliniaccpt = sum(Initial.Approvals, na.rm = T),
                                                  totaliniden = sum(Initial.Denials, na.rm = T),
                                                  totalinitial = sum(Initial.Approvals,na.rm = T)+sum(Initial.Denials,na.rm = T),
                                                  iaccptperc = (totaliniaccpt/totalinitial)*100, 
                                                  idenperc = (totaliniden/totalinitial)*100)


ggplot(initialbyyear, aes(x=Fiscal.Year, y=iaccptperc)) + 
    geom_line(aes(color=naics, group=naics), size = 1) +   # create the line by nacis code
    ggtitle("Line Plot of Industry and  Initial Approvals Percentage by Year")+
    geom_point(aes(color=naics), size=3) +  # for visualization purpose, we set up the point for each year so people can directly see the rate change of industry by year 
    theme(plot.title = element_text(hjust = 0.5)) +  # since we change the size of the figer, we need to relocate the fig name to center
    xlab("Year")+ ylab("Percentage(%)")+  # rename x and y axis names
    geom_dl(aes(label = naics, color = naics), method = list(dl.combine("first.polygons", "last.polygons"), cex = 1))+  #set up label for each line
    scale_x_continuous(breaks=seq(2009, 2019, 1))+   # changing the scale for both x and y axis
    scale_y_continuous(breaks=seq(50, 100, 5)) 

#ggsave("iaccptperc.png", width=12, height=9)

#write.csv(initialbyyear, file = "initialbyyear.csv")

# ggplot(initialbyyear, aes(x=Fiscal.Year, y=idenperc)) + 
#     geom_line(aes(color=naics, group=naics), size = 1) + 
#     ggtitle("Line Plot of Industry and  Initial Denials Percentage by Year")+
#     geom_point(aes(color=naics), size=3) +
#     theme(plot.title = element_text(hjust = 0.5)) + 
#     xlab("Year")+ ylab("Percentage(%)")+
#     geom_dl(aes(label = naics, color = naics), method = list(dl.combine("first.polygons", "last.polygons"), cex = 1))+
#     scale_x_continuous(breaks=seq(2009, 2019, 1))+
#     scale_y_continuous(breaks=seq(50, 100, 5))
# ggsave("idenperc.png", width=12, height=9)


```
As shown in the figure, NAICS 54, Professional, Scientific, and Technical Services, increase the initial approval percentage significantly between 2009 to 2010 by 15.68%. This is because the growing job opportunities in these field, especially for information technology services (IT). Regarding the article that Lauren Csorny publish on Bureau of Labor Statistics, employment rate in IT industry has grown by 37% since 2003. During the financial crisis, however, all industries were brain drain. After the recession and market recovery, employment of IT industry has restored and exceed compare to 2008. (Csorny)

Besides, the initial approval percentage of this industry drop significantly between 2017 to 2018 by 29.37%. The main reason is because of U.S new president, Donald Trump’s executive order, which makes H-1B tougher to get approved. This change directly affects tech companies because most of them rely on H-1B labors. Richard Burke, president and CEO of Envoy Global, conveyed that some companies are looking for labors in U.S, but they couldn’t find sufficient candidates. (Molla) Therefore, the figure shows us IT industry is not the only one got higher denial rate but others also get more denials on H-1B application. 





### 4.2.2: Continuing Application

```{r fig.width=12, fig.height=9, continuewithyear, echo = 0}
#use group by to combine same industry together to calculate the total continuing application amount.
continuingbyyear <- h1b %>% group_by(Fiscal.Year, naics) %>% summarize(totalconaccpt = sum(Continuing.Approvals, na.rm = T),
                                                  totalconden = sum(Continuing.Denials, na.rm = T),
                                                  totalcontinue = sum(Continuing.Approvals,na.rm = T)+sum(Continuing.Denials,na.rm = T),
                                                  caccptperc = (totalconaccpt/totalcontinue) * 100,
                                                  cdenperc = ( totalconden /totalcontinue) * 100 )


ggplot(continuingbyyear, aes(x=Fiscal.Year, y=caccptperc)) + 
    geom_line(aes(color=naics, group=naics), size = 1) + 
    ggtitle("Line Plot of Industry and Continuing Approvals Percentage by Year")+
    geom_point(aes(color=naics), size=3) +
    theme(plot.title = element_text(hjust = 0.5)) + 
    xlab("Year")+ ylab("Percentage(%)")+
    geom_dl(aes(label = naics, color = naics), method = list(dl.combine("first.polygons", "last.polygons"), cex = 1))+
    scale_x_continuous(breaks=seq(2009, 2019, 1))+
    scale_y_continuous(breaks=seq(50, 100, 5))

#ggsave("caccptperc.png", width=12, height=9)

# ggplot(continuingbyyear, aes(x=Fiscal.Year, y=cdenperc)) + 
#     geom_line(aes(color=naics, group=naics),size = 1) + 
#     ggtitle("Line Plot of Industry and Continuing Denials Percentage by Year")+
#     geom_point(aes(color=naics), size=3) +
#     theme(plot.title = element_text(hjust = 0.5)) + 
#     xlab("Year")+ ylab("Percentage(%)")+
#     geom_dl(aes(label = naics, color = naics), method = list(dl.combine("first.polygons", "last.polygons"), cex = 1))+
#     scale_x_continuous(breaks=seq(2009, 2019, 1))+
#     scale_y_continuous(breaks=seq(50, 100, 5))
# 
# ggsave("cdenperc.png", width=12, height=9)

```
The H-1B continuing approval rate for NAICS 11, Agriculture, Forestry, Fishing and Hunting, drop 20.43% in 2018, which decreased the most compare to other industries. These is also due to the new H-1B policy. Since there are more and more paper work need to be submitted by applicants, and the reviewing process takes longer and longer, more agriculture companies shift the visa to H-2A, Temporary Agricultural Workers. 


# Chapter 5: Year (& Policy) Factor

## 5.1: Industries vs NAICS 

In this Chapter, we are 

### 5.1.1: S.M.A.R.T Question

Donald Trump?!!!!!!!!!





# Chapter 6: Conculsion 


no idea~~~~~~




# Citation

What is H1B Visa? (n.d.). Retrieved October 14, 2019, from https://www.path2usa.com/what-is-h1b-visa.

USCIS Reaches FY 2019 H-1B Cap. (2018, April 6). Retrieved October 14, 2019, from https://www.uscis.gov/news/alerts/uscis-reaches-fy-2019-h-1b-cap.

Buy American and Hire American. (2019, April 26). Retrieved October 14, 2019, from https://www.uscis.gov/legal-resources/buy-american-hire-american-putting-american-workers-first.

Kumar. (2019, May 26). H1B Historical Data – Lottery vs 85K Quota, Masters vs Regular Split. Retrieved October 22, 2019, from https://redbus2us.com/h1b-historical-data-lottery-vs-85k-quota-masters-vs-regular-split/.

Search NAICS Codes by Industry. (n.d.). Retrieved October 15, 2019, from https://www.naics.com/search-naics-codes-by-industry/.

SIC Major Group: 99 Nonclassifiable Establishments. (n.d.). Retrieved October 21, 2019, from https://www.naics.com/standard-industrial-code-divisions/?code=99.

Zaveri, P., & Roy, A. (2019, April 2). Changes to H-1B visa lottery create 'stress' for tech companies and employees. Retrieved October 22, 2019, from https://www.cnbc.com/2019/04/01/h1-b-lottery-changes-in-2018-masters-candidates-more-inspections.html.

Yang, Y. (2018, February 22). Big Banks in U.S. Forced to Reevaluate Hiring Foreign Workers. Retrieved October 23, 2019, from https://www.bloomberg.com/news/articles/2018-02-22/big-banks-in-u-s-forced-to-reevaluate-hiring-foreign-workers.

Kihn, S. (2018, July 8). Demand for mining staff spans all levels and skills. Retrieved October 23, 2019, from http://www.mining.com/demand-mining-staff-spans-levels-skills/.

Brandon, C. N. (2012). Emerging Workforce Trends in the U.S. Mining Industry. Retrieved from https://www.smenet.org/SME/media/Government/201201_EmergingWorkforceTrendsinUSMiningIndustry.pdf

Csorny, L. (2013, April). Careers in the growing field of information technology services : Beyond the Numbers. Retrieved October 23, 2019, from https://www.bls.gov/opub/btn/volume-2/careers-in-growing-field-of-information-technology-services.htm.

Molla, R. (2019, February 28). Visa approvals for tech workers are on the decline. That won't just hurt Silicon Valley. Retrieved October 23, 2019, from https://www.vox.com/2019/2/28/18241522/trump-h1b-tech-work-jobs-overseas.

