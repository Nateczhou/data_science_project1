---
title: "Project1"
output: html_document
---

```{r}
h1b <- read.csv('h1b_datahubexport_2009-2019.csv')
str(h1b)
#h1b$State
```

1. How have U.S. H1b visa acceptances and denials changed over the course of 2015-2019?
  1a) How does industry effect H1b visas from the time spanning 2015-2019?
  1b) How does US location effect H1b visas from 2015-2019?
  1c) How does year affect H1b visa acceptance from 2015-2019?
  1d) How has the change in presidency from 2015-2019 affected H1b visa acceptances and denials?
  
IV: H1b initial approvals
    H1b iniitial denials
    H1b continuing approvals
    H1b continuing denials

DV: type of industry
    U.S. location
    year/time (total 10 yrs and 2015-2019)
    U.S. presidency
    
    
```{r}
library(dplyr)
library(tidyr)
```
    
```{r}
#nas <- na.omit(h1b$State)
#nas
new <- h1b %>% drop_na(State) %>% group_by(State) %>%
  summarise(totalinitialapp = sum(Initial.Approvals, na.rm = T),
            totalinitialden = sum(Initial.Denials, na.rm = T),
            totalcontapp = sum(Continuing.Approvals, na.rm = T),
            totalcontden = sum(Continuing.Denials, na.rm = T))

test <- h1b %>% drop_na(State) %>% group_by(State) %>%
  summarise(totalinitialapp = sum(Initial.Approvals, na.rm = T))
```

```{r}
library(ggplot2)
#install.packages("maps")
library(maps)
#install.packages("openintro")
library(openintro)
library(tidyverse)
```

```{r}
usstate <- map_data("state")
copy <- map_data("state")
colnames(usstate)[colnames(usstate)=="region"] <- "State_name"
usstate <- usstate %>% mutate(State = state2abbr(State_name))

new$State <- as.character(new$State)
state_lo <- inner_join(usstate, new, by = "State")
head(state_lo)
```

```{r}
state_approval <- state_lo %>% select(long, lat, group, order, State, totalinitialapp, State_name)
head(state_approval)
```

```{r}
state_den <- state_lo %>% select(long, lat, group, order, State, totalinitialden, State_name)
state_contapp <- state_lo %>% select(long, lat, group, order, State, totalcontapp, State_name)
state_contden <- state_lo %>% select(long, lat, group, order, State, totalcontden, State_name)
```


```{r}
us_base <- ggplot(data = state_approval, mapping = aes(x = long, y = lat, group = group)) +
  coord_fixed(1.3) +
  geom_polygon(color = "black", fill = "gray")

#us_base + theme_nothing()

#us_base + theme_nothing() +
#  geom_polygon(data = state_approval, fill = NA, group = group, color = "white") +
#  geom_polygon(color = "black", fill = NA)

ditch_the_axes <- theme(
  axis.text = element_blank(),
  axis.line = element_blank(),
  axis.ticks = element_blank(),
  panel.border = element_blank(),
  panel.grid = element_blank(),
  axis.title = element_blank()
  )

elbow_rooml <- us_base + geom_polygon(data = state_approval, aes(fill = totalinitialapp), color = "white") +
  geom_polygon(color = "black", fill = NA) +
  theme_bw() +
  ditch_the_axes

```

#### map of initial approval
```{r}
#<<<<<<< Updated upstream
elbow_rooml 

eb1 <- elbow_rooml + scale_fill_gradient(trans = "log10")
eb1

eb2 <- elbow_rooml + scale_fill_gradientn(colours = rainbow(7), breaks = c(min(state_approval$totalinitialapp),1000, 6000, median(state_approval$totalinitialapp), 100000, max(state_approval$totalinitialapp)), trans = "log10")
eb2 
#>>>>>>> Stashed changes 
```

#### map of initial denial
```{r}
elbow_room2 <- us_base + geom_polygon(data = state_den, aes(fill = totalinitialden), color = "white") +
  geom_polygon(color = "black", fill = NA) +
  theme_bw() +
  ditch_the_axes

eb3 <- elbow_room2 + scale_fill_gradientn(colours = rev(rainbow(7)), breaks = c(min(state_den$totalinitialden),1000, 6000, median(state_den$totalinitialden), 100000, max(state_den$totalinitialden)), trans = "log10")
eb3
```

### map of continue approval
```{r}
elbow_room3 <- us_base + geom_polygon(data = state_contapp, aes(fill = totalcontapp), color = "white") +
  geom_polygon(color = "black", fill = NA) +
  theme_bw() +
  ditch_the_axes

eb4 <- elbow_room3 + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_contapp$totalcontapp),1000, 6000, median(state_contapp$totalcontapp), 100000, max(state_contapp$totalcontapp)), trans = "log10") +
  labs(title = "US map of continue approvals in each state", colours = "Numbers of Continue Approvals\n")
eb4
```

#### map of continue denial
```{r}
elbow_room4 <- us_base + geom_polygon(data = state_contden, aes(fill = totalcontden), color = "white") +
  geom_polygon(color = "black", fill = NA) +
  theme_bw() +
  ditch_the_axes

eb5 <- elbow_room4 + scale_fill_gradientn(colours = c(low = "white", high = "dark blue"), breaks = c(min(state_contden$totalcontden),1000, 6000, median(state_contden$totalcontden), 100000, max(state_contden$totalcontden)), trans = "log10")
eb5
```

#### relations
```{r}

```

